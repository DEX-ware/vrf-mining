\section{Related work}
\label{sec:related}

To the best of our knowledge, VRF-based mining is the first construction that makes pooled mining \textit{impossible}.
In this section, we briefly review related research on preventing mining pools, and compare them with VRF-based mining.
We classify related research to two types, namely mining protocols trying to address pooled mining, and decentralised mining pools.

\subsection{Mining protocols}

\begin{table}[]
    \centering
    \caption{Comparison between mining protocols.}
    \begin{tabular}{lllll}
        \hline
                            & VRF-based mining & Puzzle-1~\cite{miller2015nonoutsourceable} & Puzzle-2~\cite{miller2015nonoutsourceable} & 2P-PoW~\cite{2P-PoW} \\ \hline
        Punishment          & Wallet           & New reward                                 & New reward                                 & Wallet               \\
        Stealing            & Unlinkable       & Linkable                                   & Unlinkable                                 & Unlinkable           \\
        No part. out.       & \cmark           & \cmark                                     & \cmark                                     & \xmark               \\
        No need deter. sig. & \cmark           & \cmark                                     & \cmark                                     & \xmark               \\
        No compl. crypto.   & \cmark           & \cmark                                     & \xmark                                     & \cmark               \\ \hline
    \end{tabular}
    \label{table:comparison-mining-protocols}
\end{table}

There are two mining protocols aiming at discouraging or breaking mining pools: the \textit{non-outsourceable scratch-off puzzle}~\cite{miller2015nonoutsourceable} and the \textit{Two Phase Proof-of-Work} (\textit{2P-PoW})~\cite{2P-PoW}.
Table~\ref{table:comparison-mining-protocols} summarises our comparisons.

\textbf{Non-outsourceable scratch-off puzzle.}
Miller et al.~\cite{miller2015nonoutsourceable} formalises cryptocurrency mining as \textit{Scratch-off puzzles}, defines \textit{Non-outsourceable scratch-off puzzles}, and proposes two constructions.
One of these two constructions achieves \textbf{Weak non-outsourceability} (i.e., miners can steal the mining reward), and the other achieves \textbf{Strong non-outsourceability} (i.e., miners can anonymously steal the mining reward).

In the weak non-outsourceable scratch-off puzzle, mining consists of three steps.
First, the miner creates a Merkle tree randomly.
Second, the miner searches for a valid nonce.
More specifically, the miner samples some leaves of the Merkle tree randomly according to nonce, and hashes their Merkle proofs together to produce a hash.
If this hash meets the difficulty requirement, the nonce is considered valid.
Last, the miner binds the valid nonce and his block template together to produce a valid block.

In order to outsource the mining process, the mining pool should distribute the search space of nonces to miners.
% how to steal
Miners can steal the mining reward by repetitively searching for a valid nonce (the first two steps) then binds this valid nonce with his own block template (the last step).
% why weak
However, in this protocol, all miners with the same view of the blockchain share the same search space of nonces, as the search space of nonces only relies on the previous block hash, rather than both the previous block hash and the block template like in Bitcoin.
By exploiting this fact, the pool operator can identify the miner who steals the mining reward.
For example, the pool operator can link the nonce in the stolen block with the miner who takes charge of the search space covering this nonce.
To achieve the \textbf{Strong non-outsourceability} (i.e., make the stealing behaviours anonymous), the strong non-outsourceable scratch-off puzzle replaces the plaintext nonce in the block with a Zero Knowledge Proof proving the statement ``I know a valid nonce''.

As discussed in \S\ref{sec:non_outsourceability}, compared to the non-outsourceable scratch-off puzzle, our VRF-based mining achieves stronger non-outsourceability, and is more efficient and simpler to implement.

\textbf{2P-PoW.}
Eyal and Sirer proposes 2P-PoW~\cite{2P-PoW}, a mining protocol that discourages pooled mining.
In 2P-PoW, there are two phases, and each phase has a difficulty parameter.
A miner should find a nonce that makes the block to pass two phases: 1) the Sha256d hash of the block meets the first difficulty, 2) the Sha256 hash of the signature of the block meets the second difficulty.
As the second requirement requires the private key, pool operators cannot outsource the second phase.

Compared to VRF-based mining that makes pooled mining impossible, 2P-PoW is partially outsourceable, as its first phase is outsourceable.
In addition, 2P-PoW should use deterministic digital signatures, while commonly used digital signatures (e.g., ECDSA, EdDSA) rely on randomisation.
If the signature is non-deterministic, the pool operator can make use of all nonces that are generated by miners and meet the first difficulty.
For example, given a nonce meeting the first difficulty, the pool operator repetitively generates signatures to meet the second requirement.
Moreover, how to adjust two difficulties still remains unknown and requires some simulations.




\subsection{Decentralised mining pools}

\begin{table}[]
    \centering
    \caption{Comparison with decentralised mining pools.}
    \begin{tabular}{ccccc}
        \hline
                         & VRF-based mining & P2Pool~\cite{voight2011p2pool}             & SmartPool~\cite{luu2017smartpool}      & BetterHash~\cite{draft-bip-BetterHash} \\ \hline
        Complexity       & -                & Blockchain & Smart contract & -          \\
        Decentralisation & Mining           & Mining             & Mining         & Select txs \\ \hline
    \end{tabular}
    \label{table:comparison-pools}
\end{table}


% ref: https://www.alexeizamyatin.me/files/Decentralized_Mining-Security_and_Attacks.pdf


Decentralised mining pool is a type of mining pool that works in a decentralised way.
More specifically, miners mine in the name of themselves rather than the pool operator, but they share reward in a fine-grained way.
In this way, miners are rewarded stably while mining power is not aggregated to pool operators.
Table~\ref{table:comparison-pools} summarises the comparison between VRF-based mining with decentralised mining pool approaches.


\textbf{P2Pool}~\cite{voight2011p2pool} is a decentralised mining pool for Bitcoin.
% how p2pool works
P2Pool runs a share-chain among all miners in the pool, and the share-chain includes shares submitted to the pool in sequence.
During mining, the coinbase transaction records the number of shares submitted by each miner, and distributes the mining reward according to miners' contribution.
In this way, once mining a Bitcoin block, the coinbase transaction will become valid, and miners will be rewarded according to their contribution.
% challenges
However, P2Pool suffers from several challenges.
First, handling the difficulty of mining shares in P2Pool is hard.
If the difficulty is high, a miner's reward will still be volatile.
If the difficulty is low, there will be numerous low-difficulty shares, which introduces huge overhead on broadcasting shares or even spamming attacks.
Second, frequent share submissions amplifies the influence of network latency which leads to high orphan share rate.
Last, P2Pool is vulnerable to temporary dishonest majority~\cite{decentralised-mining-pool-security}.

\textbf{SmartPool}~\cite{luu2017smartpool} is another decentralised mining pool, which uses a smart contract to replace the centralised pool operator.
% con 1: smart contract
As relying on smart contracts, SmartPool cannot work on blockchains without smart contracts.
% con 2: network delay
In addition, as blockchains achieve limited throughput, transaction processing might be congested and mining reward might be delayed, especially when a large number of miners participate in the SmartPool.
% con 3: compute and storage overhead
Moreover, as the SmartPool smart contract should verify the validity of blocks, miners should submit the whole block (with transactions) to the SmartPool.
Verifying blocks introduces significant overhead on computing (so expensive transaction fees), and storing blocks in the SmartPool smart contract also introduces significant overhead on storing the blockchain.



\textbf{BetterHash}~\cite{draft-bip-BetterHash} is another decentralised mining protocol, which has been integrated into \textbf{Stratum V2}~\cite{stratum-v2}, the next generation of the \textit{Stratum}~\cite{stratum} pooled mining protocol.
In \textit{BetterHash}, the block operator allows miners to choose transactions and construct blocks in his name, rather than constructing block templates by himself.
Thus, \textit{BetterHash} only contributes to the decentralisation of constructing blocks, but does not contribute to the decentralisation of mining power.