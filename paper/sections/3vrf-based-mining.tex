\section{VRF-based mining}

% intuitive
Instead of using a hash function, VRF-based mining uses a VRF to produce hashes that satisfy the difficulty requirement.
Different from hash functions, VRF takes both an input and a secret key to produce a hash.
In addition, the owner of this secret key can produce a proof proving that the hash is generated by himself.
Thus, to outsource the mining process, the pool operator should show his secret key to miners.
However, with the secret key, any miner in the mining pool can steal all coins of the pool operator.


\begin{algorithm}[H]
\caption{$\mathsf{Work}(sk, t, Target)$.}
\label{algo:work}
\SetAlgoLined
\KwIn{The secret key $sk$, the block template $t$, and the difficulty parameter $Target$}
\KwOut{The block $blk$, the VRF output $h$, and the VRF proof $\pi$}
  Initialise $n$, $h$, $blk$ \Comment*[r]{Initialise variables}
  \While (\Comment*[f]{Refresh the nonce}) {$n \gets \mathsf{nextNonce}()$}{
    $blk \gets \mathsf{constructBlock}(t, n)$ \Comment*[r]{Assemble the block}
    $h \gets \mathsf{VRFHash}(sk, blk)$ \Comment*[r]{Produce the VRF output}
    \If (\Comment*[f]{If meeting difficulty}) {$h < Target$}{
      break; \Comment*[r]{Mining successful}
    }
  }
  $\pi \gets \mathsf{VRFProve}(sk, blk)$ \Comment*[r]{Produce the proof}
  \Return{$blk$, $h$, $\pi$} \Comment*[r]{Return block, hash and proof}
\end{algorithm}

\RH{Note that $\pi$ acts both a digital signature of this block and a proof of onwership of the hash}




\begin{algorithm}[H]
\caption{$\mathsf{Verify}(blk, h, \pi, Target)$}
\label{algo:verify}
\SetAlgoLined
$pk \gets blk . txs[0] . scriptPubKey$ \Comment*[r]{Find pubkey in coinbase tx}
$\mathsf{require}(h < Target)$ \Comment*[r]{Hash should meet diff requirement}
\tcc{Here $\mathsf{VRFVerify}(\cdot)$ guarantees:\\
1. $h$ is generated by the owner of $pk$\\
1. $h$ is the valid output of $\mathsf{VRFProve}(sk, blk)$\\
2. $blk$ is mined by the owner of $pk$}
$\mathsf{require}(\mathsf{VRFVerify}(pk, blk, h, \pi))$ \;
$\dots$ \Comment*[l]{Verify other fields}
$\dots$ \Comment*[l]{Verify transactions}
\end{algorithm}

\RH{describe}