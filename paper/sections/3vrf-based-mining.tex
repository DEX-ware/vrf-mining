\section{VRF-based mining}

\subsection{Our construction}

Intutively, 

We replace hash function in mining by VRF, and thus construct VRF-based mining.

To rule out pooled mining, we combine VRF with digital signature scheme.
As the digital signature scheme used in cryptocurrency are based on Elliptic curve, we construct Elliptic curve based VRF for our VRF-based mining.
A standardised construction of VRF can be found in Appendix~\ref{vrf_standardised_construction}.


\RH{We should align to Scratch-off puzzle paper's Definition 1. More specifically,
1. symbols
2. we should not call these two phases miner side, node side, phase 1 and phase 2. Instead, the first algorithm is Work, the second is Prove (we have but Miller's paper does not have), and Verify.
Runchao will do this}


In the case of solo mining, our scheme, which contains a miner side and a node side, works as follows. Note that we divide the blockheader into two part:
one part containing $pk$, $\beta$, and $\pi$ (which will be explained later);
and the other part not containing them.
We call the later part $\alpha$.

\subsubsection{Miner side\\}

A Miner performs mining as described in Algorithm ~\ref{algo:vft-mining-1}.

\RH{revise this pseudocode according to Vincent Gramoli's paper. In particular, we should add inline comments. Runchao will do this}

\begin{algorithm}[H]
\caption{VRF Mining Phase 1}
\label{algo:vft-mining-1}
\SetAlgoLined
  $(sk, pk) \gets \mathsf{VRFKeyGen}(1^{\lambda})$\;
  build a block template, including a coinbase transaction paying to the \texttt{scriptPubKey} of $pk$\;
  $\beta \gets \mathsf{VRFHash}(sk, \alpha)$\;
  \While{$\beta > target$}{
    alter the nonce in $\alpha$\;
    $\beta \gets \mathsf{VRFHash}(sk, \alpha)$\;
  }
  $\pi \gets \mathsf{VRFProve}(sk, \alpha)$\;
  submit $pk$, $\beta$, and the proof $\pi$ to the node.
\end{algorithm}

\subsubsection{Node side\\}

Upon receiving $pk$, $\beta$, and $\pi$, the node then performs Algorithm~\ref{algo:vft-mining-2}.

\begin{algorithm}[H]
\caption{VRF Mining Phase 2}
\label{algo:vft-mining-2}
\SetAlgoLined
\If{$\beta$ $\le$ target}{
    \If{$\mathsf{VRFVerify}(pk, \alpha, \beta, \pi)$}{
        \If{the coinbase transaction is paying to the \texttt{scriptPubKey} of $pk$}{
        record $pk$, $\beta$ and $\pi$ in the block\;
        produce a new block, with coinbase reward paying to the miner\;
        propogate the block to other nodes\;
        }
    }
}
\end{algorithm}

The $pk$, $\beta$ and $\pi$ are recorded in the blockheader, so that, when the block is propogated to other nodes, they can easily validate it via $\mathsf{VRFVerify}(pk, \alpha, \beta, \pi)$.


