\section{Profitability of partial outsourcing}
\label{sec:partial-outsourcing}

The pool operator may still have opportunity to outsource mining partially.
$\mathsf{VRFHash}$ consists of three steps: $h \gets H_1(\alpha)$, $\gamma \gets h^{sk}$ and $\beta \gets H_2(\gamma)$.
The non-outsourceability is from the second step $\gamma = h^{sk}$, as it requires the knowledge of the pool operator's secret key $sk$.
The pool operator can outsource the first step $h = H_1(\alpha)$ by distributing different $\alpha$s to miners, and also the last step $\beta = H_2(\gamma)$ by distributing different $\gamma$s to miners.

However, such partial outsourcing is very inefficient and unprofitable compared to outsourcing in hash-based mining, due to the computing and I/O overhead.
In this section, we theoretically and experimentally show the (un)profitability of such partial outsourcing.
First, we compare the process of outsourcing in hash-based mining and VRF-based mining.
Then, we model and compare their overhead of outsourcing.
Our result is \TODO{xxxxxxxx}

\subsection{Pooled mining protocols}

\begin{figure}[htp]
    \centering
    \includegraphics[width=.7\linewidth]{figs/outsource-original.png}
    \caption{Outsourcing in hash-based mining.}
    \label{fig:outsource-original}
\end{figure}
\begin{figure}[htp]
    \centering
    \includegraphics[width=.7\linewidth]{figs/outsource-vrf.png}
    \caption{Partial outsourcing in VRF-based mining.}
    \label{fig:outsource-vrf}
\end{figure}

Figure~\ref{fig:outsource-original} describes the outsourcing process in hash-based mining, and Figure~\ref{fig:outsource-vrf} describe the process of outsourcing $H_1$ and $H_2$.

\textbf{Outsourcing in hash-based mining.}
Conventional mining pools employ the Stratum mining protocol~\cite{}, which works as follows.
First, a pool operator specifies the pool difficulty $PoolTarget$ - a difficulty lower than the blockchain network - and a search interval $[n_1, n_m]$ of nonces.
Then, the pool operator sends the block template $t$, $PoolTarget$, $n_1$ and $n_m$ to the miner, and the miner starts to find a nonce in $[n_1, n_m]$ which satisfies $PoolTarget$.
Once finding a valid nonce $n_k$, the miner sends $n_k$ back to the pool operator.
The pool operator then verifies whether $n_k$ produces a hash satisfying $PoolTarget$, and records the miner's contribution (a.k.a. a share) if valid.
As $PoolTarget$ is easier to solve, the pool operator can recover the real mining power from miners from submitted shares in a more fine-grained way.
Thus, the pool operator can distribute the reward also in a fine-grained way, thus mitigate the mining reward variance.

\textbf{Partial outsourcing in VRF-based mining.}
As aforementioned, in VRF-based mining the second step $h^{sk}$ is non-outsourceable, but the pool operator can outsource $H_1$ or $H_2$ interactively.

To outsource $H_1$, the pool operator generates a search interval $[n_1, n_m]$ of nonces, then sends the interval and the block template $t$ to a miner.
After that, the miner computes $H_1$ with each nonce in $[n_1, n_m]$ as input, then sends back all $H_1$ hashes to the pool operator.
If the pool operator does not trust miners (which reflects to the real world), he will verify these $H_1$ hashes before the second step i.e., multiplying each hash with his secret key $sk$.

After the second step, the pool operator obtains a series of $(\gamma_1, \gamma_2, \dots, \gamma_m)$, and he can outsource $H_2$ as follows.
The pool operator first sends these $\gamma$s as well as the pool difficulty $PoolTarget$ to the miner.
Then, the miner calculates $H_2$ hashes of these $\gamma$s, compare the hashes with $PoolTarget$, and sends back $\gamma$s that satisfy the difficulty (denoted as $\Gamma$).
Similarly, the pool operator optionally verifies the correctness of each of $\Gamma$, and accumulates the mined shares to the miner's total contribution.


\subsection{The cost of verifying hashes from miners}

The first obstacle of partial outsourcing is verifying hashes from miners.
If the pool operator does not trust miners, he should verify both $H_1$ and $H_2$ hashes from miners, which is identical to miners' work.
For $H_1$, the pool operator should verify all of $h_1, h_2, \dots, h_m$.
For $H_2$, the pool operator should only verify $\Sigma$ i.e., $\sigma$s satisfying $PoolTarget$.
\TODO{xxx}


\subsection{Partial outsourcing is I/O intensive}

First, partially outsourcing VRF-based mining is I/O intensive.
\TODO{xxx}


\subsection{Mining speedup is limited by etwork latency}

\begin{table}
    \centering
    \begin{tabular}{|c|c|c|}
        \hline
        Region     & Mean latency & Std. of latency \\\hline
        asia   & 222.432500    & 20.921093    \\\hline
        eu     & 244.542182    & 18.354686    \\\hline
        us     & 213.937091    & 12.389635    \\\hline
    \end{tabular}
\end{table}





\subsection{The number of miners can be limited by making $\mathsf{VRFHash}$ slow}